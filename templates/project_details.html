{% extends 'base.html' %}

{% block title %}{{project.name}}{% endblock %}

{% block content %}
<div class=userinfo>
</div>
<div class=project>
    Project Name: {{project.name}}<br>
    <a href="https://www.ravelry.com/projects/{{username}}/{{project.rav_page}}">Ravelry Page</a><br>
    Pattern: {{project.pattern_name}}<br>
    Last Updated: {{project.updated_at}}<br>
    Status: {{project.status.status if project.status else " "}}<br>
    Started: {{project.started_at if project.started_at else " "}}<br>
    Notes: {{project.notes if project.notes else " "}}<br>
    Progress: {{project.progress}}<div class="progress">
  <div class="progress-bar" role="progressbar" aria-valuenow="{{project.progress}}"
  aria-valuemin="0" aria-valuemax="100" style="width: {{project.progress}}%">
<!--     <span class="sr-only">70% Complete</span> -->
  </div>
</div>
</div>
<div class=pics>
    {% for img in images %}
        <img src="{{img.url}}">
    {% endfor %}
<div class=update>
    <button> <h3>Update Project </h3></button>
    <form action="/projects/{{project.project_id}}" method="POST" id="updateproject" hidden>
        Notes: <textarea name="notes" form="updateproject">{{project.notes}}</textarea><br>
        Status: <select name="status">
            <option value="1">In progress</option>
            <option value="2">Fishished</option>
            <option value="3">Hibernating</option>
            <option value="4">Frogged/ Deleted</option>
        </select><br>
        <div id="slidecontainer">
          Progress: <span id="loacation"></span> % <br>
          <input type="range" min="1" max="100" value="{{project.progress|safe}}" class="slider" id="myRange" name="progress">
        </div>
        <span id="finished" hidden>Finished: <input type="date" name="finished_at"><br> </span>
        Photo URL:<input type="url" name="img-url"><br>
        <input type="submit"><input type="reset">
    </form>

</div>
<script src="https://code.jquery.com/jquery.js"></script>
<script>
    // set the status intially to the current status
    $("#updateproject select option").each( function() {
        if ($(this).val() == {{project.status_id|tojson}}) {
            $(this).attr('selected', true);
        } 
    });

    var slider = document.getElementById("myRange");
    var output = document.getElementById("loacation");
    output.innerHTML = slider.value; // Display the default slider value

    // Update the current slider value (each time you drag the slider handle)
    slider.oninput = function() {
        output.innerHTML = this.value;
    }

    if($('#updateproject select').val() == 2) {
        $('#finished').show();
    };
    $('#updateproject select').change( function(evt){
        var currentStatus = $('#updateproject select').val();
        if (currentStatus == 2) {
           var message = "Congratulations for finishing a project! Be sure to set the finished date!";
           $('#flash').show();
           $('#flash h3').html(message);
           $('#flash').fadeOut(3000);

           $('#finished').show(); 
       }
       else {
       $('#finished').hide();
       $("#flash h3").empty();
        }
    });

    $('.update button').on('click', function() {
        $('#updateproject').toggle();
    });

</script>
{% endblock %}